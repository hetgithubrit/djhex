<%- include('../partials/head', { title: 'Videos', navLinks, currentPath }) %>

  <main>
    <div class="wrapper">
      <section class="section video-section">
        <div class="section-head">
          <div>
            <div class="pill">Watch</div>
            <h2>Live Performances</h2>
          </div>
        </div>
        
        <div id="video-grid" class="video-grid">
          <% if (videos && videos.length > 0) { %>
            <% videos.forEach((video, index) => { %>
              <div class="video-card" onclick="openModal('/video/<%= video.filename %>')">
                <video src="/video/<%= video.filename %>#t=1" muted preload="metadata" onmouseover="this.play()" onmouseout="this.pause();this.currentTime=0;"></video>
                <div class="video-overlay">
                  <div class="play-icon"></div>
                </div>
                <div class="video-title"><%= video.title %></div>
              </div>
            <% }) %>
          <% } else { %>
            <div style="color: rgba(255,255,255,0.5); grid-column: 1/-1; text-align: center; padding: 40px;">
              No videos found. Added videos to <code>/public/video/</code> will appear here.
            </div>
          <% } %>
        </div>
      </section>
    </div>
  </main>
  
  <!-- Video Modal -->
  <div id="video-modal" class="video-modal">
    <button class="modal-close" aria-label="Close video">âœ•</button>
    <div class="modal-content">
      <video id="modal-video" controls playsinline></video>
    </div>
  </div>
  
  <a class="whatsapp-fab" href="https://wa.me/918140442505" target="_blank" aria-label="Chat on WhatsApp">
    <svg viewBox="0 0 32 32" role="presentation">
      <path d="M16.02 4C9.94 4 5 8.76 5 14.6c0 2.09.62 4.03 1.7 5.67L5 28l7.03-1.85c1.26.35 2.59.54 3.99.54 6.07 0 11.02-4.76 11.02-10.6C27.04 8.76 22.1 4 16.02 4Zm0 19.2c-1.25 0-2.47-.2-3.6-.6l-.26-.09-4.17 1.1 1.11-4.02-.17-.26a8.58 8.58 0 0 1-1.36-4.73c0-4.82 4.03-8.74 9-8.74 4.96 0 9 3.92 9 8.74 0 4.82-4.04 8.74-9 8.74Zm5.23-6.5c-.29-.14-1.72-.84-1.99-.93-.27-.1-.47-.14-.67.14-.2.29-.77.93-.94 1.12-.17.19-.34.22-.63.08-.29-.15-1.23-.45-2.34-1.43-.86-.76-1.44-1.7-1.61-1.99-.17-.29-.02-.45.13-.59.13-.13.29-.34.44-.51.15-.17.2-.29.3-.48.1-.19.05-.36-.02-.5-.07-.14-.67-1.61-.92-2.2-.24-.58-.49-.5-.67-.5-.17 0-.36-.02-.55-.02-.19 0-.5.07-.76.36-.26.29-1 1-.99 2.43 0 1.43 1.03 2.81 1.18 3 .15.19 2.04 3.22 5 4.42.7.29 1.25.46 1.68.59.7.22 1.34.19 1.84.12.56-.08 1.72-.7 1.96-1.38.24-.68.24-1.26.17-1.38-.07-.12-.26-.19-.55-.33Z"></path>
    </svg>
  </a>

<%- include('../partials/footer', { year }) %>

<script>
    const modal = document.getElementById('video-modal');
    const modalVideo = document.getElementById('modal-video');
    const modalClose = document.querySelector('.modal-close');

    // Modal Logic
    function openModal(src) {
      modalVideo.src = src;
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
      // Slight delay to ensure element is visible before play
      setTimeout(() => {
        modalVideo.play().catch(e => console.log("Autoplay prevented:", e));
      }, 50);
    }

    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
      modalVideo.pause();
      modalVideo.currentTime = 0;
      setTimeout(() => {
        modalVideo.src = '';
      }, 300);
    }

    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) closeModal();
    });
</script>
